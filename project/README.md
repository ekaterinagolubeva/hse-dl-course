# От Атлантики до Авиньона: диалог эпох

## Идея

Выбор данных для проекта Из всего датасета мы отобрали изображения работ только двух художников:

    * Уинслоу Гомер (Winslow Homer): 14 изображений. Американский художник-реалист XIX века, известный морскими пейзажами, сценами повседневной жизни и изображениями природы. Его стиль характеризуется реалистичным изображением света, цвета и динамики (например, волны, ветер, люди в естественной среде).

    * Пабло Пикассо (Pablo Picasso): 17 изображений. Испанский художник XX века, один из основоположников кубизма, с абстрактными формами, геометрическими фигурами и экспериментами с перспективо

Идея проекта — создать "диалог эпох" через генеративное искусство: обучить Stable Diffusion на стилях двух контрастных художников, чтобы сгенерировать серию изображений, иллюстрирующих эволюцию искусства от классического реализма к модернистскому кубизму.

## Данные

Для обучения моделей Stable Diffusion мы использовали данные из National Gallery of Art Open Data Program — открытого репозитория, предоставляемого Национальной галереей искусства США (National Gallery of Art, NGA). Этот датасет содержит метаданные о более чем 130,000 произведениях искусства из коллекции галереи, включая информацию об авторах, названиях работ, датах создания, материалах и ссылках на изображения. Данные доступны в формате CSV и обновляются ежедневно.

Репозиторий: github.com/NationalGalleryOfArt/opendata

Страница с политикой открытого доступа к изображениям: nga.gov/artworks/free-images-and-open-access
Дисклеймер о легальности использования

Данные и изображения из этого источника выпущены под лицензией Creative Commons Zero (CC0 1.0), что означает полное отречение от авторских прав и смежных прав. Это позволяет свободно использовать, модифицировать, распространять и применять данные в любых целях, включая коммерческие, без необходимости указания авторства или получения разрешения.

    > Мы собрали датасет вручную из открытого источника, отобрав качественные изображения (без шумов, высокое разрешение), чтобы обеспечить хорошую обучаемость.


## Пайплайн обучения

### Что такое LoRA?

LoRA (Low-Rank Adaptation) — это умный способ обучить огромную нейросеть, не трогая большую часть её весов. Вместо того чтобы менять все 865 миллионов параметров Stable Diffusion, мы добавляем к ней маленькие "адаптеры" и обучаем только их. В результате обучаем всего **0.6% параметров**, что сильно экономит память и время.

### Основные этапы

#### 1. Подготовка данных
- Загружаем 31 картину (14 Гомера + 17 Пикассо)
- Изменяем размер до 512×512 пикселей
- Нормализуем значения цветов

#### 2. Загрузка модели
Stable Diffusion состоит из нескольких частей:
- **VAE** — сжимает изображения в 64 раза (экономия памяти!)
- **Text Encoder** — понимает текстовые описания
- **UNet** — главная нейросеть, которую мы обучаем
- **Noise Scheduler** — управляет процессом шумоподавления

Мы "замораживаем" всё, кроме UNet, то есть обучаем только его.

#### 3. Применение LoRA
Добавляем маленькие адаптеры к ключевым слоям UNet:
- Слои внимания (attention) — учат, на что смотреть
- Проекционные слои — преобразуют данные
- Свёрточные слои — выделяют паттерны

#### 4. Процесс обучения
На каждом шаге происходит во тчто:
1. Берём картину и сжимаем её через VAE
2. Добавляем к ней случайный шум
3. Просим UNet угадать, какой шум мы добавили
4. Сравниваем с правдой и корректируем адаптеры

Модель учится понимать, как "выглядит шум" на картинах Гомера и Пикассо. Потом она сможет убирать этот шум, создавая новые изображения в их стиле!

#### 5. Оптимизации для GPU
Используем специальные трюки, чтобы уместиться в видеопамять:
- **Mixed Precision (fp16)** — числа занимают в 2 раза меньше места
- **Gradient Checkpointing** — экономим память за счёт скорости
- **xFormers** — ускоряем механизм внимания

#### 6. Генерация
После обучения "надеваем" наши адаптеры на оригинальную Stable Diffusion. Получается модель, которая генерирует в стиле двух художников одновременно! Процесс генерации:
1. Начинаем со случайного шума
2. Постепенно убираем шум за 30 шагов
3. Получаем готовое изображение

### Почему это круто?

- **Быстро**: обучение занимает ~15 минут вместо часов
- **Экономно**: нужно всего 12-15 GB видеопамяти
- **Эффективно**: маленький датасет (31 картина) даёт отличные результаты
- **Гибко**: можно "включать" и "выключать" лора адаптеры

## Результат

В результате обучения через LoRA мы сгенерировали серию изображений, сочетающих реалистичный стиль Уинслоу Гомера (морские пейзажи, динамика природы) с кубизмом Пабло Пикассо (геометрические формы, абстракция). Ниже примеры сгенерированных работ:

![0](/project/assets/generated_lora/sdx_img_lora_9.png)
![0](/project/assets/generated_lora/sdx_img_lora_8.png)


